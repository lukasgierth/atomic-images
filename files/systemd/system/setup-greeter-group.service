[Unit]
Description=Set up greeter group and add all users to it
ConditionPathExists=!/etc/setup-greeter-group
After=multi-user.target

[Service]
Type=oneshot
ExecStart=/usr/bin/bash -c "getent group greeter &> /dev/null || groupadd -r greeter; for user in $(getent passwd | grep 'home' | awk -F: '{print $1}'); do usermod -aG greeter $user; done"
ExecStart=/usr/bin/touch /etc/setup-greeter-group
ExecStart=/usr/bin/systemctl restart greeter.service

[Install]
WantedBy=multi-user.target
