modules:
  - type: dnf
    repos:
      files:
        - https://mise.jdx.dev/rpm/mise.repo
        - https://pkgs.tailscale.com/stable/fedora/tailscale.repo
      nonfree: rpmfusion
      cleanup: true
    remove:
      packages:
        - firefox
        - firefox-langpacks
        - net-tools
    replace:
      - from-repo: fedora-multimedia
        packages:
          - old: ffmpeg-free
            new: ffmpeg
          - old: libfdk-aac-free
            new: libfdk-aac
          - old: libavcodec-free
            new: libavcodec
    install:
      packages:
        - ImageMagick
        - abcde
        - alsa-firmware
        - android-tools
        - android-udev-rules
        - ansible
        - aria2
        - arp-scan
        - bat
        - borgbackup
        - borgmatic
        - btop
        - cmake
        - ctags
        - curl
        - ddrescue
        - detox
        - dfu-util
        - distrobox
        - duf
        - esptool
        - f3
        - fastfetch
        - fd-find
        - fish
        - flatpak-spawn
        - fuse # for AppImages
        - fzf
        - gcc
        - gcc-c++
        - gdu
        - git
        - glibc-static
        - grub2-tools-extra
        - gzip
        - httpx
        - intel-vaapi-driver
        - iperf3
        - libheif
        - lshw
        - luajit
        - make
        - mediainfo
        - mise
        - mosh
        - neovim
        - newsboat
        - nodejs
        - onefetch # for nvim lsp
        - openrgb-udev-rules
        - openssl
        - pam-u2f
        - pam_yubico
        - pamu2fcfg
        - pandoc
        - picocom
        - pipewire-libs-extra
        - podman-compose
        - podman-tui
        - procs
        - ripgrep
        - rsync
        - ruby # for nvim lsp
        - shntool
        - smartmontools
        - solaar-udev
        - squashfs-tools
        - stow
        - stress-ng
        - subfinder
        - symlinks
        - tailscale
        - tcpdump
        - tealdeer
        - tmux
        - unzip
        - uv
        - whipper
        - wireguard-tools
        - wireshark
        - wl-clipboard
        - yt-dlp
        - yubikey-manager
        - zstd

  - type: dnf
    repos:
      copr:
        - gierth/tiny-tools
      cleanup: true
    install:
      packages:
        - RustScan
        - ansel-bin
        - blisp
        - chezmoi
        - dfu-programmer
        - eza
        - git-cliff
        - hurl
        - lazygit
        - rs-tftpd
        - sjust
        - systemctl-tui
        - sysz
        - trippy
        - yazi
        - zellij

  - type: files
    files:
      - source: desktop-shared
        destination: /

  - type: systemd
    system:
      enabled:
        - podman.socket
      disabled:
        - flatpak-system-update.timer

  - type: script
    snippets:
      - "echo 'Hidden=true' >> /usr/share/applications/btop.desktop"
      - "echo 'Hidden=true' >> /usr/share/applications/gcdmaster.desktop"
      - "echo 'Hidden=true' >> /usr/share/applications/nvim.desktop"
      - "echo 'Hidden=true' >> /usr/share/applications/nvtop.desktop"

  - type: kargs
    arch: x86_64, aarch64
    kargs:
      - preempt=full
      - radeon.si_support=0
      - radeon.cik_support=0
      - amdgpu.si_support=1
      - amdgpu.cik_support=1
      - nouveau.config=NvGspRm=1
      - rd.luks.options=discard

  - from-file: modules/ublue-packages.yaml
  - from-file: modules/virtualization.yaml
  - from-file: modules/docker.yaml
  - from-file: shared.yaml
  - from-file: modules/flatpaks.yaml
